"use strict";var Ve=Object.create;var z=Object.defineProperty;var ze=Object.getOwnPropertyDescriptor;var qe=Object.getOwnPropertyNames;var Xe=Object.getPrototypeOf,Ye=Object.prototype.hasOwnProperty;var Qe=(t,e)=>{for(var r in e)z(t,r,{get:e[r],enumerable:!0})},Ce=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of qe(e))!Ye.call(t,o)&&o!==r&&z(t,o,{get:()=>e[o],enumerable:!(n=ze(e,o))||n.enumerable});return t};var q=(t,e,r)=>(r=t!=null?Ve(Xe(t)):{},Ce(e||!t||!t.__esModule?z(r,"default",{value:t,enumerable:!0}):r,t)),Ze=t=>Ce(z({},"__esModule",{value:!0}),t);var xe=(t,e,r)=>{if(!e.has(t))throw TypeError("Cannot "+r)};var He=(t,e,r)=>(xe(t,e,"read from private field"),r?r.call(t):e.get(t)),Ke=(t,e,r)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,r)},pe=(t,e,r,n)=>(xe(t,e,"write to private field"),n?n.call(t,r):e.set(t,r),r);var zt={};Qe(zt,{activate:()=>Gt});module.exports=Ze(zt);var J=q(require("vscode"));var p=q(require("vscode"));function ue(t){for(;t.length;){let e=t.pop();e&&e.dispose()}}var X=class{constructor(){this._isDisposed=!1;this._disposables=[]}dispose(){this._isDisposed||(this._isDisposed=!0,ue(this._disposables))}_register(e){return this._isDisposed?e.dispose():this._disposables.push(e),e}get isDisposed(){return this._isDisposed}};var Y=class{constructor(){this._webviews=new Set}*get(e){let r=e.toString();for(let n of this._webviews)n.resource===r&&(yield n.webviewPanel)}has(e){return!this.get(e).next().done}add(e,r){let n={resource:e.toString(),webviewPanel:r};this._webviews.add(n),r.onDidDispose(()=>{this._webviews.delete(n)})}};var K=class extends X{constructor(r,n,o){super();this._edits=[];this._savedEdits=[];this.pathRegExp=/(?<dirname>.*)\/(?<filename>(?<basename>.*)(?<extname>\.[^.]+))$/;this._onDidDispose=this._register(new p.EventEmitter);this.onDidDispose=this._onDidDispose.event;this._onDidChangeDocument=this._register(new p.EventEmitter);this.onDidChangeContent=this._onDidChangeDocument.event;this._onDidChange=this._register(new p.EventEmitter);this.onDidChange=this._onDidChange.event;this._uri=r,this._documentData=n,this._delegate=o}static async create(r,n,o){let a=typeof n=="string"?p.Uri.parse(n):r,i=await K.readFile(a);return new K(r,i,o)}static async readFile(r){if(r.scheme==="untitled")return new Uint8Array;let a=(p.workspace.getConfiguration("sqliteViewer").get("maxFileSize")??200)*2**20,i=await p.workspace.fs.stat(r);return a!==0&&i.size>a?null:p.workspace.fs.readFile(r)}get uri(){return this._uri}get uriParts(){let{dirname:r,filename:n,basename:o,extname:a}=this._uri.toString().match(this.pathRegExp)?.groups??{};return{dirname:r,filename:n,basename:o,extname:a}}get documentData(){return this._documentData}dispose(){this._onDidDispose.fire(),super.dispose()}makeEdit(r){this._edits.push(r),this._onDidChange.fire({label:"Stroke",undo:async()=>{this._edits.pop(),this._onDidChangeDocument.fire({edits:this._edits})},redo:async()=>{this._edits.push(r),this._onDidChangeDocument.fire({edits:this._edits})}})}async save(r){await this.saveAs(this.uri,r),this._savedEdits=Array.from(this._edits)}async saveAs(r,n){let o=await this._delegate.getFileData();n.isCancellationRequested||await p.workspace.fs.writeFile(r,o)}async revert(r){let n=await K.readFile(this.uri);this._documentData=n,this._edits=this._savedEdits,n&&this._onDidChangeDocument.fire({content:n,edits:this._edits})}async refresh(r){let n=await K.readFile(this.uri);this._documentData=n,this._edits=[],n&&this._onDidChangeDocument.fire({content:n,edits:[]})}async backup(r,n){return await this.saveAs(r,n),{id:r.toString(),delete:async()=>{try{await p.workspace.fs.delete(r)}catch{}}}}};var Q=class{constructor(e,r){this._context=e;this.credentials=r;this.webviews=new Y;this._onDidChangeCustomDocument=new p.EventEmitter;this.onDidChangeCustomDocument=this._onDidChangeCustomDocument.event;this._requestId=1;this._callbacks=new Map}async openCustomDocument(e,r,n){let o=await K.create(e,r.backupId,{getFileData:async()=>{let i=[...this.webviews.get(o.uri)];if(!i.length)throw new Error("Could not find webview to save for");let s=i[0],c=await this.postMessageWithResponse(s,"getFileData",{});return new Uint8Array(c)}}),a=[];return a.push(o.onDidChange(i=>{this._onDidChangeCustomDocument.fire({document:o,...i})})),a.push(o.onDidChangeContent(i=>{for(let s of this.webviews.get(o.uri)){let{filename:c}=o.uriParts,{buffer:d,byteOffset:f,byteLength:M}=o.documentData||{},T={buffer:d,byteOffset:f,byteLength:M};this.postMessage(s,"update",{filename:c,value:T,editable:!1},[d])}})),o.onDidDispose(()=>ue(a)),o}async resolveCustomEditor(e,r,n){this.webviews.add(e.uri,r),r.webview.options={enableScripts:!0},r.webview.html=await this.getHtmlForWebview(r.webview),r.webview.onDidReceiveMessage(o=>this.onMessage(e,o)),r.webview.onDidReceiveMessage(async o=>{if(o.type==="ready"&&this.webviews.has(e.uri))if(this.credentials.token.then(a=>a&&this.postMessage(r,"token",{token:a})),e.uri.scheme==="untitled")this.postMessage(r,"init",{filename:"untitled",untitled:!0,editable:!1});else{let{buffer:i,byteOffset:s,byteLength:c}=e.documentData||{},d={buffer:i,byteOffset:s,byteLength:c},{filename:f}=e.uriParts;this.postMessage(r,"init",{filename:f,value:d,editable:!1},[i])}})}saveCustomDocument(e,r){return e.save(r)}saveCustomDocumentAs(e,r,n){return e.saveAs(r,n)}revertCustomDocument(e,r){return e.revert(r)}backupCustomDocument(e,r,n){return e.backup(r.destination,n)}async getHtmlForWebview(e){let r=p.Uri.joinPath(this._context.extensionUri,"mySolidTest","build-vscode"),n=p.Uri.joinPath(this._context.extensionUri,"node_modules","@vscode/codicons","dist","codicon.css"),o=s=>e.asWebviewUri(p.Uri.joinPath(r,s));return new TextDecoder().decode(await p.workspace.fs.readFile(p.Uri.joinPath(r,"index.html"))).replace(/(href|src)="(\/[^"]*)"/g,(s,c,d)=>`${c}="${o(d)}"`).replace("<!--HEAD-->",`
        <link rel="stylesheet" crossorigin href="${e.asWebviewUri(n)}"/>
        <link rel="preload" crossorigin as="fetch" id="assets/worker.js" href="${o("assets/worker.js")}"/>
        <link rel="preload" crossorigin as="fetch" id="assets/sqlite3.wasm" type="application/wasm" href="${o("assets/sqlite3.wasm")}"/>
        <link rel="preload" crossorigin as="fetch" id="assets/sqlite3-opfs-async-proxy.js" href="${o("assets/sqlite3-opfs-async-proxy.js")}"/>
      `).replace("<!--BODY-->","")}postMessageWithResponse(e,r,n){let o=this._requestId++,a=new Promise(i=>this._callbacks.set(o,i));return e.webview.postMessage({type:r,requestId:o,body:n}),a}postMessage(e,r,n,o){e.webview.postMessage({type:r,body:n},o)}async onMessage(e,r){switch(r.type){case"refresh":e.uri.scheme!=="untitled"&&e.refresh();return;case"blob":let{data:n,download:o,metaKey:a}=r,{dirname:i}=e.uriParts,s=p.Uri.parse(`${i}/${o}`);await p.workspace.fs.writeFile(s,n),a||await p.commands.executeCommand("vscode.open",s);return;case"response":{this._callbacks.get(r.requestId)?.(r.body);return}}}},Pe={webviewOptions:{retainContextWhenHidden:!0},supportsMultipleEditorsPerDocument:!1},Z=class extends Q{static register(e,r){return p.window.registerCustomEditorProvider(Z.viewType,new Z(e,r),Pe)}},k=Z;k.viewType="sqlite-viewer.view";var j=class extends Q{static register(e,r){return p.window.registerCustomEditorProvider(j.viewType,new j(e,r),Pe)}},L=j;L.viewType="sqlite-viewer.option";var be=q(require("vscode"));var ee=q(require("vscode"));function le(){if(ee.env.uiKind==ee.UIKind.Web)return globalThis;{let{FormData:t,Headers:e,Request:r,Response:n,Blob:o,File:a,fetch:i}=require("node-fetch");return{FormData:t,Headers:e,Request:r,Response:n,Blob:o,File:a,fetch:i}}}var h=crypto,S=t=>t instanceof CryptoKey;var E=new TextEncoder,w=new TextDecoder,ir=2**32;function P(...t){let e=t.reduce((o,{length:a})=>o+a,0),r=new Uint8Array(e),n=0;return t.forEach(o=>{r.set(o,n),n+=o.length}),r}var We=t=>{let e=atob(t),r=new Uint8Array(e.length);for(let n=0;n<e.length;n++)r[n]=e.charCodeAt(n);return r},b=t=>{let e=t;e instanceof Uint8Array&&(e=w.decode(e)),e=e.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return We(e)}catch{throw new TypeError("The input to be decoded is not correctly encoded.")}};var A=class extends Error{static get code(){return"ERR_JOSE_GENERIC"}constructor(e){var r;super(e),this.code="ERR_JOSE_GENERIC",this.name=this.constructor.name,(r=Error.captureStackTrace)===null||r===void 0||r.call(Error,this,this.constructor)}},g=class extends A{static get code(){return"ERR_JWT_CLAIM_VALIDATION_FAILED"}constructor(e,r="unspecified",n="unspecified"){super(e),this.code="ERR_JWT_CLAIM_VALIDATION_FAILED",this.claim=r,this.reason=n}},N=class extends A{static get code(){return"ERR_JWT_EXPIRED"}constructor(e,r="unspecified",n="unspecified"){super(e),this.code="ERR_JWT_EXPIRED",this.claim=r,this.reason=n}},$=class extends A{constructor(){super(...arguments),this.code="ERR_JOSE_ALG_NOT_ALLOWED"}static get code(){return"ERR_JOSE_ALG_NOT_ALLOWED"}},u=class extends A{constructor(){super(...arguments),this.code="ERR_JOSE_NOT_SUPPORTED"}static get code(){return"ERR_JOSE_NOT_SUPPORTED"}};var l=class extends A{constructor(){super(...arguments),this.code="ERR_JWS_INVALID"}static get code(){return"ERR_JWS_INVALID"}},_=class extends A{constructor(){super(...arguments),this.code="ERR_JWT_INVALID"}static get code(){return"ERR_JWT_INVALID"}};var B=class extends A{constructor(){super(...arguments),this.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED",this.message="signature verification failed"}static get code(){return"ERR_JWS_SIGNATURE_VERIFICATION_FAILED"}};var te=h.getRandomValues.bind(h);function C(t,e="algorithm.name"){return new TypeError(`CryptoKey does not support this operation, its ${e} must be ${t}`)}function re(t,e){return t.name===e}function fe(t){return parseInt(t.name.slice(4),10)}function tt(t){switch(t){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw new Error("unreachable")}}function rt(t,e){if(e.length&&!e.some(r=>t.usages.includes(r))){let r="CryptoKey does not support this operation, its usages must include ";if(e.length>2){let n=e.pop();r+=`one of ${e.join(", ")}, or ${n}.`}else e.length===2?r+=`one of ${e[0]} or ${e[1]}.`:r+=`${e[0]}.`;throw new TypeError(r)}}function Je(t,e,...r){switch(e){case"HS256":case"HS384":case"HS512":{if(!re(t.algorithm,"HMAC"))throw C("HMAC");let n=parseInt(e.slice(2),10);if(fe(t.algorithm.hash)!==n)throw C(`SHA-${n}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!re(t.algorithm,"RSASSA-PKCS1-v1_5"))throw C("RSASSA-PKCS1-v1_5");let n=parseInt(e.slice(2),10);if(fe(t.algorithm.hash)!==n)throw C(`SHA-${n}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!re(t.algorithm,"RSA-PSS"))throw C("RSA-PSS");let n=parseInt(e.slice(2),10);if(fe(t.algorithm.hash)!==n)throw C(`SHA-${n}`,"algorithm.hash");break}case"EdDSA":{if(t.algorithm.name!=="Ed25519"&&t.algorithm.name!=="Ed448")throw C("Ed25519 or Ed448");break}case"ES256":case"ES384":case"ES512":{if(!re(t.algorithm,"ECDSA"))throw C("ECDSA");let n=tt(e);if(t.algorithm.namedCurve!==n)throw C(n,"algorithm.namedCurve");break}default:throw new TypeError("CryptoKey does not support this operation")}rt(t,r)}function Te(t,e,...r){if(r.length>2){let n=r.pop();t+=`one of type ${r.join(", ")}, or ${n}.`}else r.length===2?t+=`one of type ${r[0]} or ${r[1]}.`:t+=`of type ${r[0]}.`;return e==null?t+=` Received ${e}`:typeof e=="function"&&e.name?t+=` Received function ${e.name}`:typeof e=="object"&&e!=null&&e.constructor&&e.constructor.name&&(t+=` Received an instance of ${e.constructor.name}`),t}var v=(t,...e)=>Te("Key must be ",t,...e);function he(t,e,...r){return Te(`Key for the ${t} algorithm must be `,e,...r)}var me=t=>S(t),m=["CryptoKey"];var st=(...t)=>{let e=t.filter(Boolean);if(e.length===0||e.length===1)return!0;let r;for(let n of e){let o=Object.keys(n);if(!r||r.size===0){r=new Set(o);continue}for(let a of o){if(r.has(a))return!1;r.add(a)}}return!0},U=st;function ct(t){return typeof t=="object"&&t!==null}function y(t){if(!ct(t)||Object.prototype.toString.call(t)!=="[object Object]")return!1;if(Object.getPrototypeOf(t)===null)return!0;let e=t;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e}var ne=(t,e)=>{if(t.startsWith("RS")||t.startsWith("PS")){let{modulusLength:r}=e.algorithm;if(typeof r!="number"||r<2048)throw new TypeError(`${t} requires key modulusLength to be 2048 bits or larger`)}};var D=(t,e,r=0)=>{r===0&&(e.unshift(e.length),e.unshift(6));let n=t.indexOf(e[0],r);if(n===-1)return!1;let o=t.subarray(n,n+e.length);return o.length!==e.length?!1:o.every((a,i)=>a===e[i])||D(t,e,n+1)},Ue=t=>{switch(!0){case D(t,[42,134,72,206,61,3,1,7]):return"P-256";case D(t,[43,129,4,0,34]):return"P-384";case D(t,[43,129,4,0,35]):return"P-521";case D(t,[43,101,110]):return"X25519";case D(t,[43,101,111]):return"X448";case D(t,[43,101,112]):return"Ed25519";case D(t,[43,101,113]):return"Ed448";default:throw new u("Invalid or unsupported EC Key Curve or OKP Key Sub Type")}},lt=async(t,e,r,n,o)=>{var a;let i,s,c=new Uint8Array(atob(r.replace(t,"")).split("").map(f=>f.charCodeAt(0))),d=e==="spki";switch(n){case"PS256":case"PS384":case"PS512":i={name:"RSA-PSS",hash:`SHA-${n.slice(-3)}`},s=d?["verify"]:["sign"];break;case"RS256":case"RS384":case"RS512":i={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${n.slice(-3)}`},s=d?["verify"]:["sign"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":i={name:"RSA-OAEP",hash:`SHA-${parseInt(n.slice(-3),10)||1}`},s=d?["encrypt","wrapKey"]:["decrypt","unwrapKey"];break;case"ES256":i={name:"ECDSA",namedCurve:"P-256"},s=d?["verify"]:["sign"];break;case"ES384":i={name:"ECDSA",namedCurve:"P-384"},s=d?["verify"]:["sign"];break;case"ES512":i={name:"ECDSA",namedCurve:"P-521"},s=d?["verify"]:["sign"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{let f=Ue(c);i=f.startsWith("P-")?{name:"ECDH",namedCurve:f}:{name:f},s=d?[]:["deriveBits"];break}case"EdDSA":i={name:Ue(c)},s=d?["verify"]:["sign"];break;default:throw new u('Invalid or unsupported "alg" (Algorithm) value')}return h.subtle.importKey(e,c,i,(a=o?.extractable)!==null&&a!==void 0?a:!1,s)};var Re=(t,e,r)=>lt(/(?:-----(?:BEGIN|END) PUBLIC KEY-----|\s)/g,"spki",t,e,r);async function ye(t,e,r){if(typeof t!="string"||t.indexOf("-----BEGIN PUBLIC KEY-----")!==0)throw new TypeError('"spki" must be SPKI formatted string');return Re(t,e,r)}var ft=(t,e)=>{if(!(e instanceof Uint8Array)){if(!me(e))throw new TypeError(he(t,e,...m,"Uint8Array"));if(e.type!=="secret")throw new TypeError(`${m.join(" or ")} instances for symmetric algorithms must be of type "secret"`)}},ht=(t,e,r)=>{if(!me(e))throw new TypeError(he(t,e,...m));if(e.type==="secret")throw new TypeError(`${m.join(" or ")} instances for asymmetric algorithms must not be of type "secret"`);if(r==="sign"&&e.type==="public")throw new TypeError(`${m.join(" or ")} instances for asymmetric algorithm signing must be of type "private"`);if(r==="decrypt"&&e.type==="public")throw new TypeError(`${m.join(" or ")} instances for asymmetric algorithm decryption must be of type "private"`);if(e.algorithm&&r==="verify"&&e.type==="private")throw new TypeError(`${m.join(" or ")} instances for asymmetric algorithm verifying must be of type "public"`);if(e.algorithm&&r==="encrypt"&&e.type==="private")throw new TypeError(`${m.join(" or ")} instances for asymmetric algorithm encryption must be of type "public"`)},mt=(t,e,r)=>{t.startsWith("HS")||t==="dir"||t.startsWith("PBES2")||/^A\d{3}(?:GCM)?KW$/.test(t)?ft(t,e):ht(t,e,r)},G=mt;function bt(t,e,r,n,o){if(o.crit!==void 0&&n.crit===void 0)throw new t('"crit" (Critical) Header Parameter MUST be integrity protected');if(!n||n.crit===void 0)return new Set;if(!Array.isArray(n.crit)||n.crit.length===0||n.crit.some(i=>typeof i!="string"||i.length===0))throw new t('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');let a;r!==void 0?a=new Map([...Object.entries(r),...e.entries()]):a=e;for(let i of n.crit){if(!a.has(i))throw new u(`Extension Header Parameter "${i}" is not recognized`);if(o[i]===void 0)throw new t(`Extension Header Parameter "${i}" is missing`);if(a.get(i)&&n[i]===void 0)throw new t(`Extension Header Parameter "${i}" MUST be integrity protected`)}return new Set(n.crit)}var R=bt;var At=(t,e)=>{if(e!==void 0&&(!Array.isArray(e)||e.some(r=>typeof r!="string")))throw new TypeError(`"${t}" option must be an array of strings`);if(e)return new Set(e)},ge=At;var xt=Symbol();function oe(t,e){let r=`SHA-${t.slice(-3)}`;switch(t){case"HS256":case"HS384":case"HS512":return{hash:r,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:r,name:"RSA-PSS",saltLength:t.slice(-3)>>3};case"RS256":case"RS384":case"RS512":return{hash:r,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:r,name:"ECDSA",namedCurve:e.namedCurve};case"EdDSA":return{name:e.name};default:throw new u(`alg ${t} is not supported either by JOSE or your javascript runtime`)}}function ie(t,e,r){if(S(e))return Je(e,t,r),e;if(e instanceof Uint8Array){if(!t.startsWith("HS"))throw new TypeError(v(e,...m));return h.subtle.importKey("raw",e,{hash:`SHA-${t.slice(-3)}`,name:"HMAC"},!1,[r])}throw new TypeError(v(e,...m,"Uint8Array"))}var Ht=async(t,e,r,n)=>{let o=await ie(t,e,"verify");ne(t,o);let a=oe(t,o.algorithm);try{return await h.subtle.verify(a,o,r,n)}catch{return!1}},Le=Ht;async function ae(t,e,r){var n;if(!y(t))throw new l("Flattened JWS must be an object");if(t.protected===void 0&&t.header===void 0)throw new l('Flattened JWS must have either of the "protected" or "header" members');if(t.protected!==void 0&&typeof t.protected!="string")throw new l("JWS Protected Header incorrect type");if(t.payload===void 0)throw new l("JWS Payload missing");if(typeof t.signature!="string")throw new l("JWS Signature missing or incorrect type");if(t.header!==void 0&&!y(t.header))throw new l("JWS Unprotected Header incorrect type");let o={};if(t.protected)try{let _e=b(t.protected);o=JSON.parse(w.decode(_e))}catch{throw new l("JWS Protected Header is invalid")}if(!U(o,t.header))throw new l("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let a={...o,...t.header},i=R(l,new Map([["b64",!0]]),r?.crit,o,a),s=!0;if(i.has("b64")&&(s=o.b64,typeof s!="boolean"))throw new l('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:c}=a;if(typeof c!="string"||!c)throw new l('JWS "alg" (Algorithm) Header Parameter missing or invalid');let d=r&&ge("algorithms",r.algorithms);if(d&&!d.has(c))throw new $('"alg" (Algorithm) Header Parameter not allowed');if(s){if(typeof t.payload!="string")throw new l("JWS Payload must be a string")}else if(typeof t.payload!="string"&&!(t.payload instanceof Uint8Array))throw new l("JWS Payload must be a string or an Uint8Array instance");let f=!1;typeof e=="function"&&(e=await e(o,t),f=!0),G(c,e,"verify");let M=P(E.encode((n=t.protected)!==null&&n!==void 0?n:""),E.encode("."),typeof t.payload=="string"?E.encode(t.payload):t.payload),T=b(t.signature);if(!await Le(c,e,T,M))throw new B;let I;s?I=b(t.payload):typeof t.payload=="string"?I=E.encode(t.payload):I=t.payload;let V={payload:I};return t.protected!==void 0&&(V.protectedHeader=o),t.header!==void 0&&(V.unprotectedHeader=t.header),f?{...V,key:e}:V}async function Ee(t,e,r){if(t instanceof Uint8Array&&(t=w.decode(t)),typeof t!="string")throw new l("Compact JWS must be a string or Uint8Array");let{0:n,1:o,2:a,length:i}=t.split(".");if(i!==3)throw new l("Invalid Compact JWS");let s=await ae({payload:o,protected:n,signature:a},e,r),c={payload:s.payload,protectedHeader:s.protectedHeader};return typeof e=="function"?{...c,key:s.key}:c}var Se=t=>Math.floor(t.getTime()/1e3);var Kt=/^(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)$/i,se=t=>{let e=Kt.exec(t);if(!e)throw new TypeError("Invalid time period format");let r=parseFloat(e[1]);switch(e[2].toLowerCase()){case"sec":case"secs":case"second":case"seconds":case"s":return Math.round(r);case"minute":case"minutes":case"min":case"mins":case"m":return Math.round(r*60);case"hour":case"hours":case"hr":case"hrs":case"h":return Math.round(r*3600);case"day":case"days":case"d":return Math.round(r*86400);case"week":case"weeks":case"w":return Math.round(r*604800);default:return Math.round(r*31557600)}};var Ne=t=>t.toLowerCase().replace(/^application\//,""),Pt=(t,e)=>typeof t=="string"?e.includes(t):Array.isArray(t)?e.some(Set.prototype.has.bind(new Set(t))):!1,ce=(t,e,r={})=>{let{typ:n}=r;if(n&&(typeof t.typ!="string"||Ne(t.typ)!==Ne(n)))throw new g('unexpected "typ" JWT header value',"typ","check_failed");let o;try{o=JSON.parse(w.decode(e))}catch{}if(!y(o))throw new _("JWT Claims Set must be a top-level JSON object");let{requiredClaims:a=[],issuer:i,subject:s,audience:c,maxTokenAge:d}=r;d!==void 0&&a.push("iat"),c!==void 0&&a.push("aud"),s!==void 0&&a.push("sub"),i!==void 0&&a.push("iss");for(let H of new Set(a.reverse()))if(!(H in o))throw new g(`missing required "${H}" claim`,H,"missing");if(i&&!(Array.isArray(i)?i:[i]).includes(o.iss))throw new g('unexpected "iss" claim value',"iss","check_failed");if(s&&o.sub!==s)throw new g('unexpected "sub" claim value',"sub","check_failed");if(c&&!Pt(o.aud,typeof c=="string"?[c]:c))throw new g('unexpected "aud" claim value',"aud","check_failed");let f;switch(typeof r.clockTolerance){case"string":f=se(r.clockTolerance);break;case"number":f=r.clockTolerance;break;case"undefined":f=0;break;default:throw new TypeError("Invalid clockTolerance option type")}let{currentDate:M}=r,T=Se(M||new Date);if((o.iat!==void 0||d)&&typeof o.iat!="number")throw new g('"iat" claim must be a number',"iat","invalid");if(o.nbf!==void 0){if(typeof o.nbf!="number")throw new g('"nbf" claim must be a number',"nbf","invalid");if(o.nbf>T+f)throw new g('"nbf" claim timestamp check failed',"nbf","check_failed")}if(o.exp!==void 0){if(typeof o.exp!="number")throw new g('"exp" claim must be a number',"exp","invalid");if(o.exp<=T-f)throw new N('"exp" claim timestamp check failed',"exp","check_failed")}if(d){let H=T-o.iat,I=typeof d=="number"?d:se(d);if(H-f>I)throw new N('"iat" claim timestamp check failed (too far in the past)',"iat","check_failed");if(H<0-f)throw new g('"iat" claim timestamp check failed (it should be in the past)',"iat","check_failed")}return o};async function ve(t,e,r){var n;let o=await Ee(t,e,r);if(!((n=o.protectedHeader.crit)===null||n===void 0)&&n.includes("b64")&&o.protectedHeader.b64===!1)throw new _("JWTs MUST NOT use unencoded payload");let i={payload:ce(o.protectedHeader,o.payload,r),protectedHeader:o.protectedHeader};return typeof e=="function"?{...i,key:o.key}:i}var Fe="github",Ge="qwtel.sqlite-viewer",{fetch:Mt}=le(),kt=["user:email","read:org"],Lt=`
-----BEGIN PUBLIC KEY-----
MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEFK3xjgL1y4OazahxzcvxUVcRPfYY
hixfUOoecMEXQ2c2wy95T/JgmiRh9MxPTdRwoSO1Ub1nVFII2s1d8E2RCw==
-----END PUBLIC KEY-----
`.trim(),Nt="ES256";async function $t(t){let{payload:e}=await ve(t,await ye(Lt,Nt)),r=e.exp,n=Date.now()/1e3;return(r-n)/(24*60*60)>29}var Bt="https://alpha.sqliteviewer.app",Ft=t=>{let e=new AbortController;return setTimeout(()=>e.abort(),t),e},O,de=class{constructor(e){Ke(this,O,void 0);this.registerListeners(e),pe(this,O,this.setToken(e))}get token(){return He(this,O)}async setToken(e){try{let r=await be.authentication.getSession(Fe,kt,{createIfNone:!1});if(r){let{account:n,accessToken:o}=r,a=e.globalState.get(`${Ge}/tokens/${n.id}`);try{if(a&&await $t(a))return a;{let i=await Mt(new URL("/sponsors/check",Bt),{headers:[["Authorization",`Bearer ${o}`]],signal:Ft(5e3).signal,mode:"cors"});if(i.ok){let{token:s}=await i.json();return e.globalState.update(`${Ge}/tokens/${n.id}`,s),s}}}catch(i){console.warn(i)}return a}}catch(r){console.warn(r)}}registerListeners(e){e.subscriptions.push(be.authentication.onDidChangeSessions(async r=>{r.provider.id===Fe&&pe(this,O,this.setToken(e))}))}};O=new WeakMap;async function Gt(t){Vt(t);let e=new de(t);t.subscriptions.push(k.register(t,e)),t.subscriptions.push(L.register(t,e))}var Ae="qwtel.sqlite-viewer";async function Vt(t){let e=t.globalState.get(Ae),r=J.extensions.getExtension(Ae).packageJSON.version;if(t.globalState.update(Ae,r),e===void 0||e!==r){let n,o=await J.window.showInformationMessage("SQLite Viewer is under active development and looking for \u{1F497} Sponsors!",...n=[{title:"GitHub Sponsors \u2197"}]);o!==null&&o===n[0]&&await J.env.openExternal(J.Uri.parse("https://github.com/sponsors/qwtel"))}}
